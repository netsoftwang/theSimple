<html>
<head>
	<meta charset="UTF-8">
	<link rel="stylesheet" type="text/css" href="../css/easyui.css">
	<link rel="stylesheet" type="text/css" href="../css/icon.css">
	<link rel="stylesheet" type="text/css" href="../css/seeds.css">
	<script type="text/javascript" src="../js/jquery.min.js"></script>
	<script type="text/javascript" src="../js/jquery.easyui.min.js"></script>
</head>

<style type="text/css">
</style>
<script type="text/javascript">
	$(function(){
		$("#tablesId").datagrid({
			url:"../../tables/getTablesPage",
			pagination:true,
			nowrap:true,
			fitColumns:true,
			singleSelect:true,
		/* 	sortName:"tableNameCF",
			sortOrder:"desc", */
			pageNumber:0,
			columns:[[
			           {field:'entId',title:'企业id',width:100},
			           {field:'tableNameZh',title:'表中文名称',width:100},
			           {field:'tableNameCF',title:'表名称',width:100},
			           {field:'type',title:'表类型',width:100},
			           {field:'status',title:'状态',width:100},
			           {field:'associate',title:'在列表中顺序',width:100}
			       ]]
		})
		
		var pager= $("#tablesId").datagrid("getPager");
		pager.pagination("beforePageText","dddd");
		console.log("ddd");
	});
	
	function addTable(ctx,serial){
		 $("#tableDlg").dialog("open");
	}
	function editTable(ctx,serial){
		var data =$("#tablesId").datagrid("getSelected");
		$("#tableNameCF").val(data.tableNameCF);
		$("#tableNameZh").val(data.tableNameZh);
		$("#type").val(data.type);
		$("#status").val(data.status);
		$("#tableDlg").dialog("open");
	}
	function removeTable(ctx,serial){
		
	}
	function doSearch(value,name){
		if(value==""){
			return;
		}else{
			var obj=new Object();
			obj["key_"+name]=value;
			$("#tablesId").datagrid("load",obj);
		}
	}
	function saveTable(){
		var val = $("#tableFormId").serialize();
		$.post("../../tables/add",val,function(res){
			if(res.code == 200){
				$.messager.alert("操作提示", "操作成功！");
			}else{
				$.messager.alert("操作提示", "操作失败！");
			}
			$("#tablesId").datagrid("reload");
			$("#tableDlg").dialog("close");
		});
	}
	
	function showTableFields(ctx,serial){
		ctx="";
		$("#dlg").dialog("open");
		var data = $("#tablesId").datagrid("getSelected");
		$("#cusFieldTableId").datagrid({
			url:"../../cusField/getCusFieldPage",
			pagination:true,
			nowrap:true,
			fitColumns:true,
			pageNumber:0,
			toolbar: [{
				iconCls: 'icon-add',
				handler:"add"
			},'-',{
				iconCls: 'icon-edit',
				handler:"edit"
			},'-',{
				iconCls: 'icon-remove',
				handler:"remove"
			}],
			 columns:[[
			           {field:'entId',title:'企业id',width:100},
			           {field:'name',title:'字段显示名称',width:100},
			           {field:'field',title:'字段名',width:100},
			           {field:'type',title:'字段类型',width:100},
			           {field:'tableName',title:'表名称',width:100},
			           {field:'viewNum',title:'在列表中顺序',width:100},
			           {field:'status',title:'状态',width:100},
			           {field:'isShow',title:'是否在列表中显示',width:100},
			           {field:'width',title:'在列表张宽度',width:100},
			           {field:'isUse',title:'是否再用',width:100},
			           {field:'isSearch',title:'是否用于搜索',width:100},
			           {field:'searchGroupId',title:'所属搜索组',width:100}
			      /*      {field:'isMutiValSerch',title:'是否多值搜索',width:100},
			           {field:'regexForm',title:'正则',width:100},
			           {field:'viewNumForm',title:'在表单中的顺序',width:100},
			           {field:'isShowForm',title:'是否在表单中显示',width:100},
			           {field:'isEditForm',title:'是否可编辑',width:100},
			           {field:'formTypeForm',title:'表单中类型',width:100},
			           {field:'groupIdFormId',title:'表单组',width:100},
			           {field:'optionKV',title:'sele可选值',width:100},
			           {field:'theClass',title:'显示样式',width:100},
			           {field:'funcs',title:'js函数',width:100},
			           {field:'action',title:'权限控制代码',width:100},
			           {field:'createTime',title:'创建时间',width:100} */
			           
			       ]]  
		})
	}
	
</script>
<!-- 主列表 -->
<body class="easyui-layout">
	<div id="tablesId"  data-options="toolbar:'#tablesSearchId'"></div>
	<div id="tablesSearchId" class="searchBox">
<!-- 	   <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-add" plain="true" onclick="newUser()">New User</a>
        <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-edit" plain="true" onclick="editUser()">Edit User</a> -->
		<a href="javascript:addTable()" class="easyui-linkbutton" iconCls="icon-add" plain="true">Add</a>
		<a href="javascript:editTable()" class="easyui-linkbutton" iconCls="icon-add" plain="true">edit</a>
		<a href="#" class="easyui-linkbutton"iconCls="icon-add" plain="true">remove</a>
		<a href="javascript:showTableFields()" class="easyui-linkbutton" data-options="iconCls:'icon-add'">编辑列</a>
		<input  class="easyui-searchbox"   plain="true"  data-options="prompt:'搜索内容',menu:'#mm',searcher:doSearch" style="width:250px;height:24px"></input>
		<div id="mm">
			<div data-options="name:'tableNameZh'">表名称</div>
			<div data-options="name:'tableNameCF'">表字段值</div>
		</div>
	</div>
</body>
<!-- 字段列表 -->
<div id="dlg" class="easyui-dialog" title="字段列表" style="width:800px;height:400px;"
    data-options="resizable:true,modal:true,closed:true">
    <div id="cusFieldTableId"></div>
</div>

<div id="tableDlg" class="easyui-dialog" title="字段列表" style="width:400px;height:200px;"
    data-options="resizable:true,modal:true,closed:true">
    <table width="100%" height="100%" valign="middle">
   		 <form id="tableFormId">
   		 <tr>
	     	<td align="right"><label for="name">表名称:</label></td>
	        <td><input class="easyui-validatebox" type="text" id="tableNameZh" name="tableNameZh" data-options="required:true"></input></td>
	     </tr>
	     <tr>
	         <td align="right"><label for="name">存储名称:</label></td>
	         <td><input class="easyui-validatebox" type="text" id="tableNameCF" name="tableNameCF" data-options="required:true"></input></td>
	     </tr>
	     <tr>
	     	<td align="right"><label for="name">类型:</label></td>
	        <td><select id="type" name="type">
	            	<option value="1">一般表</option>
	            	<option value="2">树状表</option>
	            </select>
	         </td>
	    </tr>
		<tr>	     
	     	<td align="right"><label >状态:</label></td>
	        <td><select id="status" name="status">
	            	<option value="1">冻结</option>
	            	<option value="2">启用</option>
	            </select>
	        </td>
	     </tr>
	     <tr>
	     	
	     	<td align="right"><input type="button" value="确定" onclick="saveTable()"></input></td>
	        <td><input type="button" value="取消" onclick="calcel(){$('#tableDlg').dialog('close')}"></input></td>
	       
	    </tr>
	    </form>
	   </table>
	  </div>
</html>